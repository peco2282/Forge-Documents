<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Capabilities - Forge Documentation</title>

    <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../images/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../images/manifest.json">
    <link rel="mask-icon" href="../../images/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="../../images/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Forge Docs">
    <meta name="application-name" content="Forge Docs">
    <meta name="msapplication-config" content="../../images/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://use.fontawesome.com/a1f20be65b.css">
    <link rel="stylesheet" href="../../css/styles_dark.css?version=2" data-theme="dark">
    <link rel="stylesheet" href="../../css/styles_light.css?version=2" data-theme="light">

    
    <link href="../../css/version_warning_fix.css" rel="stylesheet">
    
    <script type="text/javascript" src="../../js/theme-switch.js"></script>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jScrollPane/2.0.23/script/jquery.jscrollpane.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/stickyfill/1.1.4/stickyfill.min.js"></script>
    <script type="text/javascript" src="../../js/theme.js"></script>

    <script>var base_url = '../..';</script>
    
    <script src="../../search/main.js"></script>
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    
</head>
<body>
<header>
    <div class="wrapper">
        <div class="logo">
            <a href="#" class="open-sidebar"><i class="fa fa-bars"></i></a>
            <a href="../.." class="logo-image"><img src="../../images/logo.svg" width="244"></a>
        </div>
        <nav>
            <ul class="links clearfix">
                <li><a href="https://minecraftforge.net/">Forums</a></li>
            </ul>
        </nav>
        
        <form role="search" id="rtd-search-form" class="search" action="../../search.html" method="get">
            <input type="submit" value="&#xf002;">
            <div class="search-field">
                <input type="search" title="Search" name="q" placeholder="Search...">
            </div>
        </form>
        
    </div>
</header>
<main class="wrapper sidebar-wrapper">
    <div class="sidebar-left sidebar-sticky">
        <aside>
            <section class="sidebar-nav">
                <h2 class="sidebar-heading">
                    <a href="#" class="close-sidebar"><i class="fa fa-bars"></i></a> Navigation
                    <form class="version-selection">
                        <label for="version-selection-dropdown">Version:</label>
                        <select id="version-selection-dropdown" class="version-selection-dropdown" onchange="location = this.value;">
                            
                            <option value="https://mcforge.readthedocs.io/en/1.15.x" selected>1.15.x</option>
                            
                            <option value="https://mcforge.readthedocs.io/en/1.16.x" >1.16.x</option>
                            
                        </select>
                    </form>
                </h2>
                <ul class="section-content scroll-pane">
                    
                    
<li >
    
    <a href="../.." class="elem-text">Home</a>
    
    
</li>

                    
                    
<li >
    
    <a href="../../styleguide/" class="elem-text">Style Guide</a>
    
    
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Getting Started</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../gettingstarted/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../gettingstarted/structuring/" class="elem-text">Structuring Your Mod</a>
    
    
</li>

        
        
<li >
    
    <a href="../../gettingstarted/autoupdate/" class="elem-text">Forge Update Checker</a>
    
    
</li>

        
        
<li >
    
    <a href="../../gettingstarted/debugprofiler/" class="elem-text">Debug Profiler</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Concepts</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../concepts/sides/" class="elem-text">Sides</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/resources/" class="elem-text">Resources</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/data/" class="elem-text">Data</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/registries/" class="elem-text">Registries</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/lifecycle/" class="elem-text">Mod Lifecycle</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/internationalization/" class="elem-text">Internationalization and localization</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Blocks</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../blocks/blocks/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../blocks/states/" class="elem-text">Blockstates</a>
    
    
</li>

        
        
<li >
    
    <a href="../../blocks/interaction/" class="elem-text">Interaction</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Tile Entities</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../tileentities/tileentity/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../tileentities/tesr/" class="elem-text">Renderer</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Items</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../items/items/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../items/globallootmodifiers/" class="elem-text">Loot Modification</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Models</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../models/introduction/" class="elem-text">Intro to Models</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/files/" class="elem-text">Model Files</a>
    
    
</li>

        
        
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Blockstates</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../models/blockstates/introduction/" class="elem-text">Intro to Blockstate JSONs</a>
    
    
</li>

        
    </ul>
</li>

        
        
<li >
    
    <a href="../../models/color/" class="elem-text">Coloring Textures</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/overrides/" class="elem-text">Item Property Overrides</a>
    
    
</li>

        
        
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Advanced Models</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../models/advanced/ibakedmodel/" class="elem-text">IBakedModel</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/advanced/perspective/" class="elem-text">Perspective</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/advanced/itemoverridelist/" class="elem-text">ItemOverrideList</a>
    
    
</li>

        
    </ul>
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Rendering</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../rendering/ister/" class="elem-text">ItemStackTileEntityRenderer</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Data Generation</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../datagen/intro/" class="elem-text">Introduction</a>
    
    
</li>

        
        
<li >
    
    <a href="../../datagen/modelproviders/" class="elem-text">Model Providers</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Events</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../events/intro/" class="elem-text">Basic Usage</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Networking</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../networking/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../networking/overview/" class="elem-text">Overview</a>
    
    
</li>

        
        
<li >
    
    <a href="../../networking/simpleimpl/" class="elem-text">SimpleImpl</a>
    
    
</li>

        
        
<li >
    
    <a href="../../networking/entities/" class="elem-text">Entities</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Data Storage</a>
    
    <ul class="nav-collapsible nav-collapsible-open">
        
        
<li class="elem-active elem-toc" >
    
    <a href="#the-capability-system" class="elem-text">Capabilities</a>
    
    
    <ul class="table-of-contents">
        
        
        
        <li class="toc-subitem"><a href="#forge-provided-capabilities">Forge-provided Capabilities</a></li>
        
        <li class="toc-subitem"><a href="#using-an-existing-capability">Using an Existing Capability</a></li>
        
        <li class="toc-subitem"><a href="#exposing-a-capability">Exposing a Capability</a></li>
        
        <li class="toc-subitem"><a href="#attaching-capabilities">Attaching Capabilities</a></li>
        
        <li class="toc-subitem"><a href="#creating-your-own-capability">Creating Your Own Capability</a></li>
        
        <li class="toc-subitem"><a href="#persisting-chunk-and-tileentity-capabilities">Persisting Chunk and TileEntity capabilities</a></li>
        
        <li class="toc-subitem"><a href="#synchronizing-data-with-clients">Synchronizing Data with Clients</a></li>
        
        <li class="toc-subitem"><a href="#persisting-across-player-deaths">Persisting across Player Deaths</a></li>
        
        <li class="toc-subitem"><a href="#migrating-from-iextendedentityproperties">Migrating from IExtendedEntityProperties</a></li>
        
        
    </ul>
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Utilities</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../utilities/recipes/" class="elem-text">Recipes</a>
    
    
</li>

        
        
<li >
    
    <a href="../../utilities/tags/" class="elem-text">Tags</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Effects</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../effects/particles/" class="elem-text">Particles</a>
    
    
</li>

        
        
<li >
    
    <a href="../../effects/sounds/" class="elem-text">Sounds</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Conventions</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../conventions/versioning/" class="elem-text">Versioning</a>
    
    
</li>

        
        
<li >
    
    <a href="../../conventions/locations/" class="elem-text">Locations</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Advanced Topics</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../advanced/accesstransformers/" class="elem-text">Access Transformers</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Contributing to Forge</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../forgedev/" class="elem-text">Getting Started</a>
    
    
</li>

        
        
<li >
    
    <a href="../../forgedev/prguidelines/" class="elem-text">PR Guidelines</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Legacy Versions</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../legacy/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../legacy/porting/" class="elem-text">Porting to 1.15</a>
    
    
</li>

        
    </ul>
</li>

                    
                </ul>
            </section>
        </aside>
    </div>

    <div class="sidebar-sticky-wrapper-content">
        <article class="docs-entry">
            
            <h1 id="the-capability-system">The Capability System<a class="headerlink" href="#the-capability-system" title="Permanent link"> </a></h1>
<p>Capabilities allow exposing features in a dynamic and flexible way without having to resort to directly implementing many interfaces.</p>
<p>In general terms, each capability provides a feature in the form of an interface, a default implementation which can be requested, and a storage handler for at least this default implementation. The storage handler can support other implementations, but this is up to the capability implementor, so look it up in their documentation before trying to use the default storage with non-default implementations.</p>
<p>Forge adds capability support to TileEntities, Entities, ItemStacks, Worlds, and Chunks, which can be exposed either by attaching them through an event or by overriding the capability methods in your own implementations of the objects. This will be explained in more detail in the following sections.</p>
<h2 id="forge-provided-capabilities">Forge-provided Capabilities<a class="headerlink" href="#forge-provided-capabilities" title="Permanent link"> </a></h2>
<p>Forge provides three capabilities: <code>IItemHandler</code>, <code>IFluidHandler</code> and <code>IEnergyStorage</code></p>
<p><code>IItemHandler</code> exposes an interface for handling inventory slots. It can be applied to TileEntities (chests, machines, etc.), Entities (extra player slots, mob/creature inventories/bags), or ItemStacks (portable backpacks and such). It replaces the old <code>IInventory</code> and <code>ISidedInventory</code> with an automation-friendly system.</p>
<p><code>IFluidHandler</code> exposes an interface for handling fluid inventories. It can also be applied to TileEntities, Entities, or ItemStacks. It replaces the old <code>IFluidHandler</code> with a more consistent and automation-friendly system.</p>
<p><code>IEnergyStorage</code> exposes an interface for handling energy containers. It can be applied to TileEntities, Entities, or ItemStacks. It is based on the RedstoneFlux API by TeamCoFH.</p>
<h2 id="using-an-existing-capability">Using an Existing Capability<a class="headerlink" href="#using-an-existing-capability" title="Permanent link"> </a></h2>
<p>As mentioned earlier, TileEntities, Entities, and ItemStacks implement the capability provider feature through the <code>ICapabilityProvider</code> interface. This interface adds the method <code>#getCapability</code>, which can be used to query the capabilities present in the associated provider objects.</p>
<p>In order to obtain a capability, you will need to refer it by its unique instance. In the case of the <code>IItemHandler</code>, this capability is primarily stored in <code>CapabilityItemHandler#ITEM_HANDLER_CAPABILITY</code>, but it is possible to get other instance references by using the <code>@CapabilityInject</code> annotation.</p>
<pre class="highlight"><code class="language-Java">@CapabilityInject(IItemHandler.class)
static Capability&lt;IItemHandler&gt; ITEM_HANDLER_CAPABILITY = null;</code></pre>
<p>This annotation can be applied to fields and methods. When applied to a field, it will assign the instance of the capability (the same one gets assigned to all fields) upon registration of the capability and left to the existing value (<code>null</code>) if the capability was never registered. Because local static field accesses are fast, it is a good idea to keep your own local copy of the reference for objects that work with capabilities. This annotation can also be used on a method, in order to get notified when a capability is registered, so that certain features can be enabled conditionally.</p>
<p>The <code>#getCapability</code> method has a second parameter, of type <code>Direction</code>, which can be used to request the specific instance for that one face. If passed <code>null</code>, it can be assumed that the request comes either from within the block or from some place where the side has no meaning, such as a different dimension. In this case a general capability instance that does not care about sides will be requested instead. The return type of <code>#getCapability</code> will correspond to a <code>LazyOptional</code> of the type declared in the capability passed to the method. For the Item Handler capability, this is <code>LazyOptional&lt;IItemHandler&gt;</code>. If the capability is not available for a particular provider, it will return an empty <code>LazyOptional</code> instead.</p>
<h2 id="exposing-a-capability">Exposing a Capability<a class="headerlink" href="#exposing-a-capability" title="Permanent link"> </a></h2>
<p>In order to expose a capability, you will first need an instance of the underlying capability type. Note that you should assign a separate instance to each object that keeps the capability, since the capability will most probably be tied to the containing object.</p>
<p>There are two ways to obtain such an instance: through the <code>Capability</code> itself or by explicitly instantiating an implementation of it. The first method is designed to use a default implementation via <code>Capability#getDefaultInstance</code>, if those default values are useful for you. In the case of the Item Handler capability, the default implementation will expose a single slot inventory, which is most probably not what you want.</p>
<p>The second method can be used to provide custom implementations. In the case of <code>IItemHandler</code>, the default implementation uses the <code>ItemStackHandler</code> class, which has an optional argument in the constructor, to specify a number of slots. However, relying on the existence of these default implementations should be avoided, as the purpose of the capability system is to prevent loading errors in contexts where the capability is not present, so instantiation should be protected behind a check testing if the capability has been registered (see the remarks about <code>@CapabilityInject</code> in the previous section).</p>
<p>Once you have your own instance of the capability interface, you will want to notify users of the capability system that you expose this capability and provide a <code>LazyOptional</code> of the interface reference. This is done by overriding the <code>#getCapability</code> method, and comparing the capability instance with the capability you are exposing. If your machine has different slots based on which side is being queried, you can test this with the <code>side</code> parameter. For Entities and ItemStacks, this parameter can be ignored, but it is still possible to have side as a context, such as different armor slots on a player (<code>Direction#UP</code> exposing the player&rsquo;s helmet slot), or about the surrounding blocks in the inventory (<code>Direction#WEST</code> exposing the input slot of a furnace). Do not forget to fall back to <code>super</code>, otherwise existing attached capabilities will stop working.</p>
<p>Capabilities must be invalidated at the end of the provider&rsquo;s lifecycle via <code>LazyOptional#invalidate</code>. For owned TileEntities and Entities, the <code>LazyOptional</code> can be invalidated within <code>#remove</code>. For non-owned providers, a runnable supplying the invalidation should be passed into <code>AttachCapabilitiesEvent#addListener</code>.</p>
<pre class="highlight"><code class="language-java">// Somewhere in your TileEntity subclass
LazyOptional&lt;IItemHandler&gt; inventoryHandlerLazyOptional;

// Supplied instance (e.g. () -&gt; inventoryHandler)
// Ensure laziness as initialization should only happen when needed
inventoryHandlerLazyOptional = LazyOptional.of(inventoryHandlerSupplier);

@Override
public &lt;T&gt; LazyOptional&lt;T&gt; getCapability(Capability&lt;T&gt; cap, Direction side) {
  if (cap == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY) {
    return inventoryHandlerLazyOptional.cast();
  }
  return super.getCapability(cap, side);
}

@Override
public void remove() {
  super.remove();
  inventoryHandlerLazyOptional.invalidate();
}</code></pre>
<p><code>Item</code>s are a special case since their capability providers are stored on an <code>ItemStack</code>. Instead, a provider should be attached through <code>Item#initCapabilities</code>. This should hold your capabilities for the lifecycle of the stack.</p>
<p>It is strongly suggested that direct checks in code are used to test for capabilities instead of attempting to rely on maps or other data structures, since capability tests can be done by many objects every tick, and they need to be as fast as possible in order to avoid slowing down the game.</p>
<h2 id="attaching-capabilities">Attaching Capabilities<a class="headerlink" href="#attaching-capabilities" title="Permanent link"> </a></h2>
<p>As mentioned, attaching capabilities to existing providers, <code>World</code>s, and <code>Chunk</code>s can be done using <code>AttachCapabilitiesEvent</code>. The same event is used for all objects that can provide capabilities. <code>AttachCapabilitiesEvent</code> has 5 valid generic types providing the following events:</p>
<ul>
<li><code>AttachCapabilitiesEvent&lt;Entity&gt;</code>: Fires only for entities.</li>
<li><code>AttachCapabilitiesEvent&lt;TileEntity&gt;</code>: Fires only for tile entities.</li>
<li><code>AttachCapabilitiesEvent&lt;ItemStack&gt;</code>: Fires only for item stacks.</li>
<li><code>AttachCapabilitiesEvent&lt;World&gt;</code>: Fires only for worlds.</li>
<li><code>AttachCapabilitiesEvent&lt;Chunk&gt;</code>: Fires only for chunks.</li>
</ul>
<p>The generic type cannot be more specific than the above types. For example: If you want to attach capabilities to <code>PlayerEntity</code>, you have to subscribe to the <code>AttachCapabilitiesEvent&lt;Entity&gt;</code>, and then determine that the provided object is an <code>PlayerEntity</code> before attaching the capability.</p>
<p>In all cases, the event has a method <code>#addCapability</code> which can be used to attach capabilities to the target object. Instead of adding capabilities themselves to the list, you add capability providers, which have the chance to return capabilities only from certain sides. While the provider only needs to implement <code>ICapabilityProvider</code>, if the capability needs to store data persistently, it is possible to implement <code>ICapabilitySerializable&lt;T extends INBT&gt;</code> which, on top of returning the capabilities, will provide NBT save/load functions.</p>
<p>For information on how to implement <code>ICapabilityProvider</code>, refer to the <a href="#exposing-a-capability">Exposing a Capability</a> section.</p>
<h2 id="creating-your-own-capability">Creating Your Own Capability<a class="headerlink" href="#creating-your-own-capability" title="Permanent link"> </a></h2>
<p>In general terms, a capability is declared and registered through a single method call to <code>CapabilityManager.INSTANCE.register(...)</code>. One possibility is to define a static <code>register()</code> method inside a dedicated class for the capability, but this is not required by the capability system. For the purpose of this documentation, we will be describing each part as a separate named class, although anonymous classes are an option.</p>
<pre class="highlight"><code class="language-java">CapabilityManager.INSTANCE.register(&lt;capability interface class&gt;, &lt;storage&gt;, &lt;default implementation factory&gt;);</code></pre>
<p>The first parameter to this method is the type that describes the capability feature. In our example, this will be <code>IExampleCapability.class</code>.</p>
<p>The second parameter is an instance of a class that implements <code>Capability$IStorage&lt;T&gt;</code>, where T is the same class we specified in the first parameter. This storage class will help manage saving and loading for the default implementation, and it can, optionally, also support other implementations. This is just a helper and does not save or load data without being called within <code>ICapabilitySerializable</code>.</p>
<pre class="highlight"><code class="language-java">private static class Storage
    implements Capability.IStorage&lt;IExampleCapability&gt; {

  @Override
  public INBT writeNBT(Capability&lt;IExampleCapability&gt; capability, IExampleCapability instance, Direction side) {
    // return an NBT tag
  }

  @Override
  public void readNBT(Capability&lt;IExampleCapability&gt; capability, IExampleCapability instance, Direction side, INBT nbt) {
    // load from the NBT tag
  }
}</code></pre>
<p>The last parameter is a callable factory that will return new instances of the default implementation.</p>
<pre class="highlight"><code class="language-java">private static class Factory implements Callable&lt;IExampleCapability&gt; {

  @Override
  public IExampleCapability call() throws Exception {
    return new Implementation();
  }
}</code></pre>
<p>Finally, we will need the default implementation itself, to be able to instantiate it in the factory. Designing this class is up to you, but it should at least provide a basic skeleton that people can use to test the capability, if it is not a fully usable implementation itself.</p>
<h2 id="persisting-chunk-and-tileentity-capabilities">Persisting Chunk and TileEntity capabilities<a class="headerlink" href="#persisting-chunk-and-tileentity-capabilities" title="Permanent link"> </a></h2>
<p>Unlike Worlds, Entities, and ItemStacks, Chunks and TileEntities are only written to disk when they have been marked as dirty. A capability implementation with persistent state for a Chunk or a TileEntity should therefore ensure that whenever its state changes, its owner is marked as dirty.</p>
<p><code>ItemStackHandler</code>, commonly used for inventories in TileEntities, has an overridable method <code>void onContentsChanged(int slot)</code> designed to be used to mark the TileEntity as dirty.</p>
<pre class="highlight"><code class="language-java">public class MyTileEntity extends TileEntity {

  private final IItemHandler inventory = new ItemStackHandler(...) {
    @Override
    protected void onContentsChanged(int slot) {
      super.onContentsChanged(slot);
      markDirty();
    }
  }

  ...
}</code></pre>
<h2 id="synchronizing-data-with-clients">Synchronizing Data with Clients<a class="headerlink" href="#synchronizing-data-with-clients" title="Permanent link"> </a></h2>
<p>By default, capability data is not sent to clients. In order to change this, the mods have to manage their own synchronization code using packets.</p>
<p>There are three different situations in which you may want to send synchronization packets, all of them optional:</p>
<ol>
<li>When the entity spawns in the world, or the block is placed, you may want to share the initialization-assigned values with the clients.</li>
<li>When the stored data changes, you may want to notify some or all of the watching clients.</li>
<li>When a new client starts viewing the entity or block, you may want to notify it of the existing data.</li>
</ol>
<p>Refer to the <a href="../../networking/">Networking</a> page for more information on implementing network packets.</p>
<h2 id="persisting-across-player-deaths">Persisting across Player Deaths<a class="headerlink" href="#persisting-across-player-deaths" title="Permanent link"> </a></h2>
<p>By default, the capability data does not persist on death. In order to change this, the data has to be manually copied when the player entity is cloned during the respawn process.</p>
<p>This can be done via <code>PlayerEvent$Clone</code> by reading the data from the original entity and assigning it to the new entity. In this event, the <code>wasDead</code> field can be used to distinguish between respawning after death and returning from the End. This is important because the data will already exist when returning from the End, so care has to be taken to not duplicate values in this case.</p>
<h2 id="migrating-from-iextendedentityproperties">Migrating from IExtendedEntityProperties<a class="headerlink" href="#migrating-from-iextendedentityproperties" title="Permanent link"> </a></h2>
<p>Although the Capability system can do everything IEEPs (IExtendedEntityProperties) did and more, the two concepts don&rsquo;t fully match 1:1. This section will explain how to convert existing IEEPs into Capabilities.</p>
<p>This is a quick list of IEEP concepts and their Capability equivalent:</p>
<ul>
<li>Property name/id (<code>String</code>): Capability key (<code>ResourceLocation</code>)</li>
<li>Registration (<code>EntityConstructing</code>): Attaching (<code>AttachCapabilitiesEvent&lt;Entity&gt;</code>), the real registration of the <code>Capability</code> happens during <code>FMLCommonSetupEvent</code>.</li>
<li>NBT read/write methods: Does not happen automatically. Attach an <code>ICapabilitySerializable</code> in the event and run the read/write methods from the <code>serializeNBT</code>/<code>deserializeNBT</code>.</li>
</ul>
<p>Features you probably will not need (if the IEEP was for internal use only):</p>
<ul>
<li>The Capability system provides a default implementation concept, meant to simplify usage by third party consumers, but it doesn&rsquo;t really make much sense for an internal Capability designed to replace an IEEP. You can safely return <code>null</code> from the factory if the capability is for internal use only.</li>
<li>The Capability system provides an <code>IStorage</code> system that can be used as a helper to read/write data from those default implementations.</li>
</ul>
<p>The following steps assume you have read the rest of the document and you understand the concepts of the capability system.</p>
<p>Quick conversion guide:</p>
<ol>
<li>Convert the IEEP key/id string into a <code>ResourceLocation</code> (which will use your MODID as a namespace).</li>
<li>In your handler class (not the class that implements your capability interface), create a field that will hold the Capability instance.</li>
<li>Change the <code>EntityConstructing</code> event to <code>AttachCapabilitiesEvent</code>, and instead of querying the IEEP, you will want to attach an <code>ICapabilityProvider</code> (probably <code>ICapabilitySerializable</code>, which allows saving/loading from NBT).</li>
<li>Create a registration method if you don&rsquo;t have one (you may have one where you registered your IEEP&rsquo;s event handlers) and in it, run the capability registration function.</li>
</ol>
            
        </article>
        
    </div>
</main>
<div class="wrapper">
    <footer>
        Built with <a href="https://www.mkdocs.org">MkDocs</a> using a custom theme. Hosted by <a href="https://readthedocs.org">Read the Docs</a>.
        <div class="theme-switch-wrapper">
            Enable Dark Theme
            <label class="theme-switch">
                <input type="checkbox">
                <span class="slider round"></span>
            </label>
        </div>
    </footer>
</div>
</body>
</html>