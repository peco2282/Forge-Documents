<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SimpleImpl - Forge Documentation</title>

    <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../images/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../images/manifest.json">
    <link rel="mask-icon" href="../../images/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="../../images/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Forge Docs">
    <meta name="application-name" content="Forge Docs">
    <meta name="msapplication-config" content="../../images/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://use.fontawesome.com/a1f20be65b.css">
    <link rel="stylesheet" href="../../css/styles_dark.css?version=2" data-theme="dark">
    <link rel="stylesheet" href="../../css/styles_light.css?version=2" data-theme="light">

    
    <link href="../../css/version_warning_fix.css" rel="stylesheet">
    
    <script type="text/javascript" src="../../js/theme-switch.js"></script>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jScrollPane/2.0.23/script/jquery.jscrollpane.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/stickyfill/1.1.4/stickyfill.min.js"></script>
    <script type="text/javascript" src="../../js/theme.js"></script>

    <script>var base_url = '../..';</script>
    
    <script src="../../search/main.js"></script>
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    
</head>
<body>
<header>
    <div class="wrapper">
        <div class="logo">
            <a href="#" class="open-sidebar"><i class="fa fa-bars"></i></a>
            <a href="../.." class="logo-image"><img src="../../images/logo.svg" width="244"></a>
        </div>
        <nav>
            <ul class="links clearfix">
                <li><a href="https://minecraftforge.net/">Forums</a></li>
            </ul>
        </nav>
        
        <form role="search" id="rtd-search-form" class="search" action="../../search.html" method="get">
            <input type="submit" value="&#xf002;">
            <div class="search-field">
                <input type="search" title="Search" name="q" placeholder="Search...">
            </div>
        </form>
        
    </div>
</header>
<main class="wrapper sidebar-wrapper">
    <div class="sidebar-left sidebar-sticky">
        <aside>
            <section class="sidebar-nav">
                <h2 class="sidebar-heading">
                    <a href="#" class="close-sidebar"><i class="fa fa-bars"></i></a> Navigation
                    <form class="version-selection">
                        <label for="version-selection-dropdown">Version:</label>
                        <select id="version-selection-dropdown" class="version-selection-dropdown" onchange="location = this.value;">
                            
                            <option value="https://mcforge.readthedocs.io/en/1.16.x" >1.16.x</option>
                            
                            <option value="https://mcforge.readthedocs.io/en/1.17.x" selected>1.17.x</option>
                            
                        </select>
                    </form>
                </h2>
                <ul class="section-content scroll-pane">
                    
                    
<li >
    
    <a href="../.." class="elem-text">Home</a>
    
    
</li>

                    
                    
<li >
    
    <a href="../../styleguide/" class="elem-text">Style Guide</a>
    
    
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Getting Started</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../gettingstarted/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../gettingstarted/structuring/" class="elem-text">Structuring Your Mod</a>
    
    
</li>

        
        
<li >
    
    <a href="../../gettingstarted/autoupdate/" class="elem-text">Forge Update Checker</a>
    
    
</li>

        
        
<li >
    
    <a href="../../gettingstarted/debugprofiler/" class="elem-text">Debug Profiler</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Concepts</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../concepts/sides/" class="elem-text">Sides</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/resources/" class="elem-text">Resources</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/data/" class="elem-text">Data</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/registries/" class="elem-text">Registries</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/lifecycle/" class="elem-text">Mod Lifecycle</a>
    
    
</li>

        
        
<li >
    
    <a href="../../concepts/internationalization/" class="elem-text">Internationalization and Localization</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Blocks</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../blocks/blocks/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../blocks/states/" class="elem-text">BlockStates</a>
    
    
</li>

        
        
<li >
    
    <a href="../../blocks/interaction/" class="elem-text">Interaction</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Block Entities</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../blockentities/blockentity/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../blockentities/ber/" class="elem-text">Renderer</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Items</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../items/items/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../items/globallootmodifiers/" class="elem-text">Loot Modification</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Models</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../models/introduction/" class="elem-text">Intro to Models</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/files/" class="elem-text">Model Files</a>
    
    
</li>

        
        
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> BlockStates</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../models/blockstates/introduction/" class="elem-text">Intro to BlockState JSON</a>
    
    
</li>

        
    </ul>
</li>

        
        
<li >
    
    <a href="../../models/color/" class="elem-text">Coloring Textures</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/itemproperties/" class="elem-text">Item Properties</a>
    
    
</li>

        
        
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Advanced Models</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../models/advanced/bakedmodel/" class="elem-text">BakedModel</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/advanced/perspective/" class="elem-text">Perspective</a>
    
    
</li>

        
        
<li >
    
    <a href="../../models/advanced/itemoverrides/" class="elem-text">Item Overrides</a>
    
    
</li>

        
    </ul>
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Rendering</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../rendering/bewlr/" class="elem-text">BlockEntityWithoutLevelRenderer</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Data Generation</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../datagen/intro/" class="elem-text">Introduction</a>
    
    
</li>

        
        
<li >
    
    <a href="../../datagen/modelproviders/" class="elem-text">Model Providers</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Events</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../events/intro/" class="elem-text">Basic Usage</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Networking</a>
    
    <ul class="nav-collapsible nav-collapsible-open">
        
        
<li >
    
    <a href="../" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../overview/" class="elem-text">Overview</a>
    
    
</li>

        
        
<li class="elem-active elem-toc" >
    
    <a href="#simpleimpl" class="elem-text">SimpleImpl</a>
    
    
    <ul class="table-of-contents">
        
        
        
        <li class="toc-subitem"><a href="#getting-started">Getting Started</a></li>
        
        <li class="toc-subitem"><a href="#the-version-checker">The Version Checker</a></li>
        
        <li class="toc-subitem"><a href="#registering-packets">Registering Packets</a></li>
        
        <li class="toc-subitem"><a href="#handling-packets">Handling Packets</a></li>
        
        <li class="toc-subitem"><a href="#sending-packets">Sending Packets</a></li>
        
        
    </ul>
    
</li>

        
        
<li >
    
    <a href="../entities/" class="elem-text">Entities</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Data Storage</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../datastorage/capabilities/" class="elem-text">Capabilities</a>
    
    
</li>

        
        
<li >
    
    <a href="../../datastorage/saveddata/" class="elem-text">Saved Data</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Utilities</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../utilities/recipes/" class="elem-text">Recipes</a>
    
    
</li>

        
        
<li >
    
    <a href="../../utilities/tags/" class="elem-text">Tags</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Effects</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../effects/particles/" class="elem-text">Particles</a>
    
    
</li>

        
        
<li >
    
    <a href="../../effects/sounds/" class="elem-text">Sounds</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Conventions</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../conventions/versioning/" class="elem-text">Versioning</a>
    
    
</li>

        
        
<li >
    
    <a href="../../conventions/locations/" class="elem-text">Locations</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Advanced Topics</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../advanced/accesstransformers/" class="elem-text">Access Transformers</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Contributing to Forge</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../forgedev/" class="elem-text">Getting Started</a>
    
    
</li>

        
        
<li >
    
    <a href="../../forgedev/prguidelines/" class="elem-text">PR Guidelines</a>
    
    
</li>

        
    </ul>
</li>

                    
                    
<li class="elem-parent">
    
    <a href="#" class="elem-text toggle-collapsible"><span class="fa fa-plus collapsible-icon"></span> Legacy Versions</a>
    
    <ul class="nav-collapsible ">
        
        
<li >
    
    <a href="../../legacy/" class="elem-text">Home</a>
    
    
</li>

        
        
<li >
    
    <a href="../../legacy/porting/" class="elem-text">Porting to 1.17</a>
    
    
</li>

        
    </ul>
</li>

                    
                </ul>
            </section>
        </aside>
    </div>

    <div class="sidebar-sticky-wrapper-content">
        <article class="docs-entry">
            
            <h1 id="simpleimpl">SimpleImpl<a class="headerlink" href="#simpleimpl" title="Permanent link"> </a></h1>
<p>SimpleImpl is the name given to the packet system that revolves around the <code>SimpleChannel</code> class. Using this system is by far the easiest way to send custom data between clients and the server.</p>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link"> </a></h2>
<p>First you need to create your <code>SimpleChannel</code> object. We recommend that you do this in a separate class, possibly something like <code>ModidPacketHandler</code>. Create your <code>SimpleChannel</code> as a static field in this class, like so:</p>
<pre class="highlight"><code class="language-java">private static final String PROTOCOL_VERSION = "1";
public static final SimpleChannel INSTANCE = NetworkRegistry.newSimpleChannel(
    new ResourceLocation("mymodid", "main"),
    () -&gt; PROTOCOL_VERSION,
    PROTOCOL_VERSION::equals,
    PROTOCOL_VERSION::equals
);</code></pre>
<p>The first argument is a name for the channel. The second argument is a <code>Supplier&lt;String&gt;</code> returning the current network protocol version. The third and fourth arguments respectively are <code>Predicate&lt;String&gt;</code> checking whether an incoming connection protocol version is network-compatible with the client or server, respectively.
Here, we simply compare with the <code>PROTOCOL_VERSION</code> field directly, meaning that the client and server <code>PROTOCOL_VERSION</code>s must always match or FML will deny login.</p>
<h2 id="the-version-checker">The Version Checker<a class="headerlink" href="#the-version-checker" title="Permanent link"> </a></h2>
<p>If your mod does not require the other side to have a specific network channel, or to be a Forge instance at all, you should take care that you properly define your version compatibility checkers (the <code>Predicate&lt;String&gt;</code> parameters) to handle additional &ldquo;meta-versions&rdquo; (defined in <code>NetworkRegistry</code>) that can be received by the version checker. These are:</p>
<ul>
<li><code>ABSENT</code> - if this channel is missing on the other endpoint. Note that in this case, the endpoint is still a Forge endpoint, and may have other mods.</li>
<li><code>ACCEPTVANILLA</code> - if the endpoint is a vanilla (or non-Forge) endpoint.</li>
</ul>
<p>Returning <code>false</code> for both means that this channel must be present on the other endpoint. If you just copy the code above, this is what it does. Note that these values are also used during the list ping compatibility check, which is responsible for showing the green check / red cross in the multiplayer server select screen.</p>
<h2 id="registering-packets">Registering Packets<a class="headerlink" href="#registering-packets" title="Permanent link"> </a></h2>
<p>Next, we must declare the types of messages that we would like to send and receive. This is done using <code>INSTANCE#registerMessage</code>, which takes 5 parameters:</p>
<ul>
<li>The first parameter is the discriminator for the packet. This is a per-channel unique ID for the packet. We recommend you use a local variable to hold the ID, and then call registerMessage using <code>id++</code>. This will guarantee 100% unique IDs.</li>
<li>The second parameter is the actual packet class <code>MSG</code>.</li>
<li>The third parameter is a <code>BiConsumer&lt;MSG, FriendlyByteBuf&gt;</code> responsible for encoding the message into the provided <code>FriendlyByteBuf</code>.</li>
<li>The fourth parameter is a <code>Function&lt;FriendlyByteBuf, MSG&gt;</code> responsible for decoding the message from the provided <code>FriendlyByteBuf</code>.</li>
<li>The final parameter is a <code>BiConsumer&lt;MSG, Supplier&lt;NetworkEvent.Context&gt;&gt;</code> responsible for handling the message itself.</li>
</ul>
<p>The last three parameters can be method references to either static or instance methods in Java. Remember that an instance method <code>MSG#encode(FriendlyByteBuf)</code> still satisfies <code>BiConsumer&lt;MSG, FriendlyByteBuf&gt;</code>; the <code>MSG</code> simply becomes the implicit first argument.</p>
<h2 id="handling-packets">Handling Packets<a class="headerlink" href="#handling-packets" title="Permanent link"> </a></h2>
<p>There are a couple things to highlight in a packet handler. A packet handler has both the message object and the network context available to it. The context allows access to the player that sent the packet (if on the server), and a way to enqueue thread-safe work.</p>
<pre class="highlight"><code class="language-java">public static void handle(MyMessage msg, Supplier&lt;NetworkEvent.Context&gt; ctx) {
    ctx.get().enqueueWork(() -&gt; {
        // Work that needs to be thread-safe (most work)
        ServerPlayer sender = ctx.get().getSender(); // the client that sent this packet
        // Do stuff
    });
    ctx.get().setPacketHandled(true);
}</code></pre>
<p>Packets sent from the server to the client should be handled in another class and wrapped via <code>DistExecutor#unsafeRunWhenOn</code>.</p>
<pre class="highlight"><code class="language-java">// In Packet class
public static void handle(MyClientMessage msg, Supplier&lt;NetworkEvent.Context&gt; ctx) {
    ctx.get().enqueueWork(() -&gt;
        // Make sure it's only executed on the physical client
        DistExecutor.unsafeRunWhenOn(Dist.CLIENT, () -&gt; () -&gt; ClientPacketHandlerClass.handlePacket(msg, ctx))
    );
    ctx.get().setPacketHandled(true);
}

// In ClientPacketHandlerClass
public static void handlePacket(MyClientMessage msg, Supplier&lt;NetworkEvent.Context&gt; ctx) {
    // Do stuff
}</code></pre>
<p>Note the presence of <code>#setPacketHandled</code>, which is used to tell the network system that the packet has successfully completed handling.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of Minecraft 1.8 packets are by default handled on the network thread.</p>
<p>That means that your handler can <em>not</em> interact with most game objects directly.
Forge provides a convenient way to make your code execute on the main thread instead through the supplied <code>NetworkEvent$Context</code>.
Simply call <code>NetworkEvent$Context#enqueueWork(Runnable)</code>, which will call the given <code>Runnable</code> on the main thread at the next opportunity.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be defensive when handling packets on the server. A client could attempt to exploit the packet handling by sending unexpected data.</p>
<p>A common problem is vulnerability to <strong>arbitrary chunk generation</strong>. This typically happens when the server is trusting a block position sent by a client to access blocks and block entities. When accessing blocks and block entities in unloaded areas of the level, the server will either generate or load this area from disk, then promptly write it to disk. This can be exploited to cause <strong>catastrophic damage</strong> to a server&rsquo;s performance and storage space without leaving a trace.</p>
<p>To avoid this problem, a general rule of thumb is to only access blocks and block entities if <code>Level#hasChunkAt</code> is true.</p>
</div>
<h2 id="sending-packets">Sending Packets<a class="headerlink" href="#sending-packets" title="Permanent link"> </a></h2>
<h3 id="sending-to-the-server">Sending to the Server<a class="headerlink" href="#sending-to-the-server" title="Permanent link"> </a></h3>
<p>There is but one way to send a packet to the server. This is because there is only ever <em>one</em> server the client can be connected to at once. To do so, we must again use that <code>SimpleChannel</code> that was defined earlier. Simply call <code>INSTANCE.sendToServer(new MyMessage())</code>. The message will be sent to the handler for its type, if one exists.</p>
<h3 id="sending-to-clients">Sending to Clients<a class="headerlink" href="#sending-to-clients" title="Permanent link"> </a></h3>
<p>Packets can be sent directly to a client using the <code>SimpleChannel</code>: <code>HANDLER.sendTo(new MyClientMessage(), serverPlayer.connection.getConnection(), NetworkDirection.PLAY_TO_CLIENT)</code>. However, this can be quite inconvenient. Forge has some convenience functions that can be used:</p>
<pre class="highlight"><code class="language-java">// Send to one player
INSTANCE.send(PacketDistributor.PLAYER.with(serverPlayer), new MyMessage());

// Send to all players tracking this level chunk
INSTANCE.send(PacketDistributor.TRACKING_CHUNK.with(levelChunk), new MyMessage());

// Send to all connected players
INSTANCE.send(PacketDistributor.ALL.noArg(), new MyMessage());</code></pre>
<p>There are additional <code>PacketDistributor</code> types available; check the documentation on the <code>PacketDistributor</code> class for more details.</p>
            
        </article>
        
    </div>
</main>
<div class="wrapper">
    <footer>
        Built with <a href="https://www.mkdocs.org">MkDocs</a> using a custom theme. Hosted by <a href="https://readthedocs.org">Read the Docs</a>.
        <div class="theme-switch-wrapper">
            Enable Dark Theme
            <label class="theme-switch">
                <input type="checkbox">
                <span class="slider round"></span>
            </label>
        </div>
    </footer>
</div>
</body>
</html>